{"version":3,"sources":["assets\\Script\\social.js"],"names":["cc","Class","Component","properties","display","Sprite","groupDisplay","_isShow","init","c","_controller","wx","showShareMenu","withShareTicket","onShareAppMessage","title","imageUrl","onAudioInterruptionEnd","musicMgr","pauseBg","resumeBg","onShow","options","scene","postMessage","message","shareTicket","openGroupRank","node","active","totalRank","director","resume","onHide","pause","getHighestLevel","highLevel","getStorageSync","getHighestScore","score","onShareButton","self","shareAppMessage","scoreMgr","levelData","level","name","onUsualShareButton","onShakePhone","vibrateShort","onGameOver","highScore","parseInt","highLevelName","gameData","json","setStorageSync","failHighScore","string","kvDataList","Array","push","key","value","setUserCloudStorage","success","fail","res","showRank","closeRank","showGroupRank","closeGroupRank","createImage","sprite","url","image","onload","texture","Texture2D","initWithElement","handleLoadedTexture","spriteFrame","SpriteFrame","src","update","getComponent","WXSubContextView","onReviveButton","type","adType","audioAd","show","load","then","err","console","log","errMsg","game","onSkipRevive","onLevelUpButton","createRewardedVideoAd","adUnitId","fakeShare","onError","onClose","isEnded","undefined","showReviveSuccess","askRevive","rebuildLevelNode","openBannerAdv","navToMiniprogram","event","custom","navigateToMiniProgram","appId","closeBannerAdv","bannerAd","hide"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\n * @author uu\n * @file  排行榜组件\n * @description 用户点击查看排行榜才检查授权,如果此时用户没有授权则进入授权界面\n */\ncc.Class({\n  extends: cc.Component,\n  properties: {\n    display: cc.Sprite,\n    groupDisplay: cc.Sprite,\n    _isShow: false,\n    // score: 0\n  },\n  init(c) {\n    this._controller = c\n    wx.showShareMenu({\n      withShareTicket: true\n    })\n    wx.onShareAppMessage(function () {\n      return {\n        title: \"开局只是个农民，现在已经做到宰相\",\n        imageUrl: 'https://mmocgame.qpic.cn/wechatgame/LtJZOjH6Z9ibiaMlpqzldsOf46Q7TZiaysI1fwc4Oj1L3CkbCaJMAMoicibbHu2HUQkOib/0'\n      }\n    })\n    // this.display.node.width = window.width\n    //this.display.node.height = window.height\n    //this.display.node.getComponent(cc.WXSubContextView).enabled = false;\n    //   this.tex = new cc.Texture2D();\n    //TODO: 微信小游戏导致音乐自动关闭 处理失败\n    // 监听\n    wx.onAudioInterruptionEnd(() => {\n      c.musicMgr.pauseBg()\n      c.musicMgr.resumeBg()\n    })\n    wx.onShow((options) => {\n      // console.log(options)\n      if (options.scene == 1044) {\n        wx.postMessage({\n          message: 'group',\n          shareTicket: options.shareTicket\n        })\n        c.openGroupRank()\n        this.display.node.active = false\n        c.totalRank.active = false\n      }\n      cc.director.resume()\n    })\n    wx.onHide(() => {\n      cc.director.pause()\n    })\n    // 获取最高官阶\n    this.getHighestLevel()\n  },\n  getHighestLevel() {\n    let highLevel = wx.getStorageSync('highLevel')\n    return highLevel\n  },\n  getHighestScore() {\n    let score = wx.getStorageSync('highScore')\n    return score\n  },\n  // --------------- share ----------------\n  onShareButton() {\n    var self = this;\n    wx.shareAppMessage({\n      title: \"我终于当上了\" + this._controller.scoreMgr.levelData[this._controller.scoreMgr.level - 1].name + \",不服来战\",\n      // imageUrlId: 'oxEwGvClT0uldQ470pM84w',\n      imageUrl: 'https://mmocgame.qpic.cn/wechatgame/LtJZOjH6Z9ibiaMlpqzldsOf46Q7TZiaysI1fwc4Oj1L3CkbCaJMAMoicibbHu2HUQkOib/0'\n    })\n  },\n  onUsualShareButton() {\n    wx.shareAppMessage({\n      title: \"开局只是个农民，现在已经做到宰相\",\n      // imageUrlId: 'oxEwGvClT0uldQ470pM84w',\n      imageUrl: 'https://mmocgame.qpic.cn/wechatgame/LtJZOjH6Z9ibiaMlpqzldsOf46Q7TZiaysI1fwc4Oj1L3CkbCaJMAMoicibbHu2HUQkOib/0'\n    })\n  },\n  onShakePhone() {\n    wx.vibrateShort()\n  },\n  // ---------------分数上传---------------\n  onGameOver(level, score) {\n    //上传分数\n    //打开开放域\n    this.score = score\n    let highLevel = level\n    let highScore = score\n    let self = this\n    highLevel = wx.getStorageSync('highLevel')\n    highLevel = parseInt(highLevel)\n    if (highLevel) {\n      highLevel = highLevel < level ? level : highLevel\n    } else {\n      highLevel = level\n    }\n    highScore = wx.getStorageSync('highScore')\n    if (highScore) {\n      highScore = parseInt(highScore)\n      highScore = highScore < score ? score : highScore\n    } else {\n      highScore = score\n    }\n    var highLevelName = this._controller.gameData.json.levelData[highLevel - 1].name\n    wx.setStorageSync('highLevel', highLevel + '')\n    wx.setStorageSync('highScore', highScore + '')\n    self._controller.scoreMgr.failHighScore.string = \"您的最高分:\" + (highScore + '')\n    var kvDataList = new Array()\n    kvDataList.push({\n      key: \"highLevel\",\n      value: highLevelName,\n    }, {\n      key: \"highScore\",\n      value: highScore + '',\n    })\n    wx.setUserCloudStorage({\n      \"KVDataList\": kvDataList,\n      success: () => {\n        //  self.showRank()\n      },\n      fail: (res) => {\n        //   console.log(res)\n      }\n    })\n  },\n  showRank() {\n    wx.postMessage({\n      message: 'Show'\n    })\n    this.display.node.active = true\n    this._isShow = true\n  },\n  // switchRankType() {\n  //   wx.postMessage({\n  //     message: 'switchRank'\n  //   })\n  //   this._isShow = true\n  // },\n  closeRank() {\n    this.display.node.active = false\n    wx.postMessage({\n      message: 'Hide'\n    })\n    this._isShow = false\n  },\n  showGroupRank() {\n    wx.postMessage({\n      message: 'Show'\n    })\n    this.groupDisplay.node.active = true\n    this._isShow = true\n  },\n  // switchRankType() {\n  //   wx.postMessage({\n  //     message: 'switchRank'\n  //   })\n  //   this._isShow = true\n  // },\n  closeGroupRank() {\n    this.groupDisplay.node.active = false\n    wx.postMessage({\n      message: 'Hide'\n    })\n    this._isShow = false\n  },\n  createImage(sprite, url) {\n    let image = wx.createImage();\n    image.onload = function () {\n      let texture = new cc.Texture2D();\n      texture.initWithElement(image);\n      texture.handleLoadedTexture();\n      sprite.spriteFrame = new cc.SpriteFrame(texture);\n    };\n    image.src = url;\n  },\n  update() {\n    if (this._isShow) {\n      if (this.display.node.active) {\n        this.display.node.getComponent(cc.WXSubContextView).update()\n      }\n      if (this.groupDisplay.node.active) {\n        this.groupDisplay.node.getComponent(cc.WXSubContextView).update()\n      }\n    }\n  },\n  // 控制打开广告\n  onReviveButton(type) {\n    // 广告位\n    let self = this\n    this.adType = type //0表示加倍 1表示复活 2表示刷新\n    if (this.audioAd) {\n      this.audioAd.show().catch(() => {\n        // 失败重试\n        this.audioAd.load()\n          .then(() => this.audioAd.show())\n          .catch(err => {\n            console.log('激励视频 广告显示失败', err.errMsg)\n            if (self.adType == 1) {\n              self._controller.game.onSkipRevive()\n            } else if(self.adType == 0) {\n              self._controller.scoreMgr.onLevelUpButton()\n            }\n            else if(self.adType == 2){\n              \n            }\n          })\n      })\n      return\n    }\n    this.audioAd = wx.createRewardedVideoAd({\n      adUnitId: 'adunit-482148cfeb243378'\n    })\n    this.audioAd.show().catch(() => {\n      // 失败重试\n      this.audioAd.load()\n        .then(() => this.audioAd.show())\n        .catch(err => {\n          self.fakeShare()\n        })\n    })\n    this.audioAd.onError(err => {\n      self.fakeShare()\n    })\n    this.audioAd.onClose((res) => {\n      if (self.adType == 1) {\n        if (res && res.isEnded || res === undefined) {\n          self._controller.game.showReviveSuccess()\n        } else {\n          self._controller.game.askRevive()\n        }\n      } else if(self.adType == 0) {\n        if (res && res.isEnded || res === undefined) {\n          self._controller.scoreMgr.onLevelUpButton(2)\n        }\n      }\n      else if (self.adType == 2){\n        if (res && res.isEnded || res === undefined) {\n          self._controller.game.rebuildLevelNode()\n        }\n      }\n    })\n  },\n  fakeShare() {\n    let self = this\n    wx.shareAppMessage({\n      title: \"我已经玩到\" + this._controller.scoreMgr.score + \"分了，邀请你来挑战\",\n      // imageUrlId: 'oxEwGvClT0uldQ470pM84w',\n      imageUrl: 'https://mmocgame.qpic.cn/wechatgame/LtJZOjH6Z9ibiaMlpqzldsOf46Q7TZiaysI1fwc4Oj1L3CkbCaJMAMoicibbHu2HUQkOib/0'\n    })\n    if (this.adType == 1) {\n      self._controller.game.showReviveSuccess()\n    } else if (this.adType == 0){\n      self._controller.scoreMgr.onLevelUpButton(2)\n    }\n    else if (this.adType == 2)\n    {\n      self._controller.game.rebuildLevelNode()\n    }\n  },\n  openBannerAdv() {\n    // 创建 Banner 广告实例，提前初始化\n    // let screenWidth = wx.getSystemInfoSync().screenWidth\n    // let bannerHeight = screenWidth / 350 * 120\n    // let screenHeight = wx.getSystemInfoSync().screenHeight - 108\n    // let adUnitIds = [\n    //   'adunit-510a4ec39065ef96',\n    //   'adunit-29b0fa7a2db8e8cb',\n    //   'adunit-4020bb9ea439e6a5'\n    // ]\n    // if (this.bannerAd) {\n    //   this.bannerAd.destroy()\n    // }\n    // this.bannerAd = wx.createBannerAd({\n    //   adUnitId: adUnitIds[Math.floor(Math.random() * 3)],\n    //   style: {\n    //     left: 0,\n    //     top: screenHeight,\n    //     width: 620,\n    //   }\n    // })\n    // // 在适合的场景显示 Banner 广告\n    // this.bannerAd.onLoad(() => {\n    //   // console.log('banner 广告加载成功')\n    // })\n    // this.bannerAd.onError((e) => {\n    //   console.log('banner 广告加载失败', e)\n    // })\n    // this.bannerAd.show()\n    //   .then()\n  },\n  navToMiniprogram(event,custom) {\n    console.log(custom)\n    wx.navigateToMiniProgram({\n      appId: custom\n    })\n  },\n  closeBannerAdv() {\n    if (this.bannerAd) {\n      this.bannerAd.hide()\n    }\n  }\n});"]}